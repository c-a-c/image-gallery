:name: Sync GitHub Issue to Notion

# ğŸŒŸ ãƒˆãƒªã‚¬ãƒ¼: IssueãŒã‚ªãƒ¼ãƒ—ãƒ³ã€ç·¨é›†ã€ã‚¯ãƒ­ãƒ¼ã‚ºã€å†ã‚ªãƒ¼ãƒ—ãƒ³ã•ã‚ŒãŸã¨ãã«å®Ÿè¡Œ
on:
  issues:
    types: [opened, edited, closed, reopened] # <- ã“ã“ã‚’æ‹¡å¼µ
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest

    env:
      NOTION_DATABASE_ID: ${{ secrets.NOTION_DATABASE_ID }}
      NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # ğŸ“¦ Node.jsç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # â¬‡ï¸ Notion APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: Install dependencies
        working-directory: .github
        run: npm install

      # ğŸƒâ€â™‚ï¸ Issueé€£æºã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
      - name: Run Notion Sync Script
        working-directory: .github
        run: node notion.js
        env:
          # Issueã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æƒ…å ±ã¨çŠ¶æ…‹ã‚’è¿½åŠ 
          ISSUE_ACTION: ${{ github.event.action }}        # opened, edited, closed ãªã©
          ISSUE_NUMBER: ${{ github.event.issue.number }}  # Issueã®é€šã—ç•ªå· (æ¤œç´¢ã‚­ãƒ¼)
          ISSUE_TITLE: ${{ github.event.issue.title }}
          ISSUE_URL: ${{ github.event.issue.html_url }}
          ISSUE_STATE: ${{ github.event.issue.state }}    # open ã¾ãŸã¯ closed
          ISSUE_LABELS: ${{ toJson(github.event.issue.labels.*.name) }} # ãƒ©ãƒ™ãƒ«æƒ…å ±ã‚’JSONå½¢å¼ã§æ¸¡ã™
          ISSUE_ASSIGNEES: ${{ toJson(github.event.issue.assignees.*.login) }} # Assigneeæƒ…å ±ã‚’JSONå½¢å¼ã§æ¸¡ã™
