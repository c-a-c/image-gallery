# CAC-image-post（仮）

## 要件定義書
```
作成者: 朝倉滉人
作成日: 2025年2月2日 更新日: 2025年2月24日
```

- [システム化の概要と目的](#システム化の概要と目的)
- [機能要件](#機能要件)
    - [外部機能](#外部機能)
        - [ログインページ](#ログインページ)
        - [TOPページ](#topページ)
        - [マイページ](#マイページ)
        - [投稿ページ](#投稿ページ)
        - [作品閲覧ページ](#作品閲覧ページ)
        - [イベントページ](#イベントページ)
    - [内部機能](#内部機能)
        - [いいね機能](#いいねコメント機能)
        - [コメント機能](#コメント機能)
        - [イラスト投稿機能](#イラスト投稿機能)
        - [データベースとの対応](#データベースとの対応)
        - [表示されるイラスト](#表示されるイラスト)
        - [認証機能](#認証機能)
        - [認証のバリデーションルールとの対応](#認証のバリデーションルールとの対応)
- [非機能要件](#非機能要件)
    - [利用範囲](#利用範囲)
    - [可用性](#可用性)
    - [性能](#性能)
    - [セキュリティ](#セキュリティ)
    - [拡張性](#拡張性)
    - [移行・引き継ぎ](#移行引き継ぎ)
    - [補足](#補足)


### システム化の概要と目的

部活内で使用する画像投稿サイトです。部員（G班）の作成したイラストを常日頃discordなどの連絡用ツールなどに投げているため、一括管理及び閲覧ができるwebサイトが欲しいのが目的です。

### 機能要件

#### 外部機能

##### ログインページ

- 機能番号page01
- 大学用のメールアドレスと自身が設定したパスワードを使って、部員のみがログインして画像投稿でき、部外の人はログインできないようにします。
- ログイン情報は以下の情報が必要です。
    - メールアドレス
    - パスワード
- サインアップ情報は以下の情報が必要です。
    - メールアドレス
    - パスワード

##### TOPページ

- 機能番号page02
- 全ユーザが投稿したイラストを一括取得して画面に一覧表示されます。このときの表示順序は時系列順、タグ順、ユーザ名順でソートができるようにします。
- 表示されるイラストは全てイラストidが存在し、イラストをクリックするとイラストidをエンドポイントとして、そのイラストの作品閲覧ページに遷移します。

##### マイページ

- 機能番号page03
- 各ユーザが投稿したイラストだけを管理する画面です。ここでユーザが投稿したイラストを削除、編集できるようにします。
- 最初このページに入るにはログインが必要です。ログインをするには大学用のメールアドレスとパスワードが必要になります。
- 大学生であっても、部員のみがログインして画像投稿でき、部外の人はログインできないようにします。

##### 投稿ページ

- 機能番号page04
- イラストを投稿する画面です。ここでイラストと以下の情報も添付してデータベースに保存します。
    - イラスト単体
    - イラスト名
    - イラストid
    - ユーザ名
    - ユーザid
    - 年齢制限
    - タグ（複数）
    - 作成日時のタイムスタンプ（xxxx年xx月xx日）
    - 更新日時のタイムスタンプ（xxxx年xx月xx日）
- 他ユーザがイラストに対してできることは以下のことです。
    - いいね
    - コメント
- 画像URLはSupabaseのStorage機能を利用して保存します。
- 作成日時と更新日時を記録します。

##### 作品閲覧ページ

- 機能番号page05
- TOPページに表示されている作品をクリックすることで遷移するページです。このページでは作品単体を表示し、ユーザはいいねおよびコメントをすることができます。作品をスクロールすると他のユーザの作品も表示され、閲覧することができます。
- イラストidからurlが発行され、そのリンクに飛べるようにします。

##### イベントページ

- 機能番号page06
- 随時行われるイラスト交流会などのイベント用のページです。イベントが行われる際にアップデートしていく必要があります。

#### 内部機能

##### いいね機能

- 機能番号inside01
- 他ユーザの投稿したイラストに対していいねをすることができます。ユーザはログインする必要があり、ログインしていない場合だといいねがすることができません。（同じ投稿に対して1ユーザー1回まで）
- いいね欄を押すと

##### コメント機能

- 機能番号inside02
- 他ユーザの投稿したイラストに対してコメントをすることができます。ユーザはログインする必要があり、ログインしていない場合だとコメントすることができません。（投稿に対して複数のコメントが可能）
- 誰がいいねしたかは確認できないようにします。

##### イラスト投稿機能

- 機能番号inside03
- ユーザがイラストを投稿できるようにします。

##### データベースとの対応

- 機能番号inside04
- 投稿したイラストはデータベースに保存されます（今回はSupabaseを使用）。

##### 表示されるイラスト

- 機能番号inside05
- TOPページ内
    - データベース内にある全イラストを取得するのでなく、ランダムに一部のイラストを取得して表示します。
    - 検索欄からタグで検索できるようにします。
    - 検索欄から名前で検索できるようにします。
    - 検索欄からユーザ名で検索できるようにします。
- マイページ内
    - 自身のユーザidを元に検索をかけてヒットしたイラストのみをデータベースから取得を行い表示します。ログインを事前にする必要があります。
- 作品閲覧ページ内
    - 1つの作品をデータベースから取得し表示します。
    - その作品のタグから関連するイラストを複数枚データベースから取得して、画面下部に表示する。

##### 認証機能

- 機能番号inside06
- ユーザー認証：正しいユーザー名とパスワードを入力したユーザーのみがシステムにアクセスできること。
- エラーハンドリング：不正な入力や認証失敗時に適切なエラーメッセージを表示すること。
- セッション管理：ログイン後はユーザー情報をセッションで管理し、ログアウトまたはセッションタイムアウトでセッションを終了すること。
- パスワード認証：パスワードはハッシュ化してデータベースに保存されるようにします。

##### 認証のバリデーションルールとの対応

- 機能番号inside07
- 大学のメールアドレス形式であることを確認します。
- 部員リストを事前に用意し、そのリストに含まれているメールアドレスのみ認証を許可します。
- 部員リストはデータベースや設定ファイルに保存します。
- この設定ファイルをGoogleスプレッドシートに保存しておきます。

### 非機能要件

#### 利用範囲

- 機能番号nr01
- 部員約100名が閲覧および投稿できることを想定しています。
- 部員以外でも外部のユーザ100名が閲覧のみできるように想定しています。

#### 可用性

- 機能番号nr02
- 基本要件
    - 24時間365日の稼働を目標とします。
- 補足
    - ただし、以下の場合の停止は認めます。
        - メンテナンスのための停止。

#### 性能

- 投稿頻度
    - 機能番号nr03
    - 各ユーザーが1日に1回投稿すると仮定すると、1日に50件の投稿が発生します。
- 閲覧頻度
    - 機能番号nr04
    - 各ユーザーが1日に10回閲覧すると仮定すると、1日に500回の閲覧が発生します。
- ストレージ容量
    - 機能番号nr05
    - 画像の平均サイズを1MBと仮定すると、1日に50MBのストレージが必要です。月間では約1.5GBとなります。

#### セキュリティ

- 機能番号nr04
- パスワードは暗号化して保存し、SQLインジェクションやクロスサイトスクリプティング（XSS）などの脆弱性に対策を講じます。
- 認証プロセスはユーザーにとって快適なレスポンス時間内に完了することです。
- Row Level Security (RLS) を全テーブルに適用します。
- ログインフォームは直感的に操作できるようにします。
- ユーザーは自分の投稿のみ編集・削除可能にします。
- 他のユーザーの投稿は閲覧のみ可能にします。

#### 拡張性

- 機能番号nr05
- 今は特に考えていません。

#### 移行・引き継ぎ

- 機能番号nr06
- webサイトの運用ができるように仕様書を残します。
- イベントページは定期的に作成をして継続しなければなりません。
- ステージング環境は用意せず、ローカルで動作確認後、本番環境へ反映させる方針でいきます。

#### 補足

- 機能番号nr07
- 対応ブラウザ
    - PC：Google Chrome（最新版）
    - スマホ：Google Chrome（最新版）、Safari（最新版）
- 利用を前提とするサービス
    - Supabase（イラストの保管）
    - Googleスプレッドシート（部員の大学用メールアドレスを管理するため。）
    - クラウドサービス（月額10万円以上の投資をすることを想定していません。）
- OSSや無償サービスの利用を推進しますが、各種権利やライセンスに反しないよう重々留意することです。

